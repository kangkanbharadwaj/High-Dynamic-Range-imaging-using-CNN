%Learning Curve

clear;

% log_file = '/misc/lmbraid19/cicek/tubule_segmentation/3d_dense1_ts-2017-10-31_17:28.log'
% log_file2 = '/misc/lmbraid19/cicek/tubule_segmentation/3d_dense1_ts-2017-11-01_17:28.log'
% log_file3 = '/misc/lmbraid19/cicek/tubule_segmentation/3d_dense1_ts-2017-11-02_17:39.log'
% log_file4 = '/misc/lmbraid19/cicek/tubule_segmentation/3d_dense1_ts-2017-11-03_17:39.log'
% log_file5 = '/misc/lmbraid19/cicek/tubule_segmentation/3d_dense1_ts-2017-11-04_17:39.log'
% log_file6 = '/misc/lmbraid19/cicek/tubule_segmentation/3d_dense1_ts-2017-11-05_17:39.log'

% log_file = '/misc/lmbraid19/cicek/ExpT86/unet3d/T86_v3/ch1/log-2017-04-11_18:30.log'

% log_file = '/misc/lmbraid19/cicek/track_dl/track_dl-2017-11-08_14:50.log'
% log_file = '/misc/lmbraid19/cicek/track_dl_aug/track_dl_aug-2017-11-08_12:03.log'
% log_file = '/misc/lmbraid19/cicek/track_ldof/track_ldof-2017-11-07_15:51.log'
% log_file = '/misc/lmbraid19/cicek/track_ldof_aug/track_ldof_aug-2017-11-07_18:12.log'
log_file1 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-01-31_18:19.log';
log_file2 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-01_18:19.log';
log_file3 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-02_18:20.log';
log_file4 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-03_18:21.log';
log_file5 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-04_18:21.log';


log_file6 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-05_18:21.log';
log_file7 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-08_16:38.log';
log_file8 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-09_16:39.log';
log_file9 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-10_16:39.log';
log_file10 = '/misc/lmbraid18/bharadwk/workspace/ws1/hdr11-2018-02-14_13:52.log';

log_text = fileread(log_file1);

%get actual loss from file
pattern = 'Iteration (\d*), loss = ([\d\.]*(e-)?[\d]*)';
% pattern2 = '#(\d*): tissue_loss = ([\d\.]*(e-)?[\d]*)';  
pattern2 = '#(\d*): loss1 = ([\d\.]*(e-)?[\d]*)'; 
%pattern3 = 'Loss: ([\d\.]*(e-)?[\d]*)';

[starts_loss, tokens_loss] = regexp(log_text, pattern, 'start', 'tokens');
[starts_loss2, tokens_loss2] = regexp(log_text, pattern2, 'start', 'tokens');

loss2 = zeros(1,600000);
iters = zeros(1,600000);

for nt = 1:numel(tokens_loss)
   loss2(1,nt) = str2double(tokens_loss2{nt}{2});
   iters(nt) = str2double(tokens_loss{nt}{1});        
end

log_text = fileread(log_file2);
  
[starts_loss3, tokens_loss3] = regexp(log_text, pattern, 'start', 'tokens');
[starts_loss4, tokens_loss4] = regexp(log_text, pattern2, 'start', 'tokens');
  
for nt = nt+1:nt+numel(tokens_loss3)
    loss2(1,nt) = str2double(tokens_loss4{nt-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss3{nt-numel(tokens_loss)}{1}); 
end

  
log_text = fileread(log_file3);

[starts_loss5, tokens_loss5] = regexp(log_text, pattern, 'start', 'tokens');
[starts_loss6, tokens_loss6] = regexp(log_text, pattern2, 'start', 'tokens');
 
for nt = nt+1:nt+numel(tokens_loss5)
    loss2(1,nt) = str2double(tokens_loss6{nt-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss5{nt-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
end
 
log_text = fileread(log_file4);
 
[starts_loss7, tokens_loss7] = regexp(log_text, pattern, 'start', 'tokens');
[starts_loss8, tokens_loss8] = regexp(log_text, pattern2, 'start', 'tokens');
 
for nt = nt+1:nt+numel(tokens_loss7)
    loss2(1,nt) = str2double(tokens_loss8{nt-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss7{nt-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
end

 log_text = fileread(log_file5);
% 
 [starts_loss9, tokens_loss9] = regexp(log_text, pattern, 'start', 'tokens');
 [starts_loss10, tokens_loss10] = regexp(log_text, pattern2, 'start', 'tokens');
% 
 for nt = nt+1:nt+numel(tokens_loss9)
    loss2(1,nt) = str2double(tokens_loss10{nt-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss9{nt-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
 end

 log_text = fileread(log_file6);
% 
 [starts_loss11, tokens_loss11] = regexp(log_text, pattern, 'start', 'tokens');
 [starts_loss12, tokens_loss12] = regexp(log_text, pattern2, 'start', 'tokens');
% 
 for nt = nt+1:nt+numel(tokens_loss11)
    loss2(1,nt) = str2double(tokens_loss12{nt-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss11{nt-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
 end

 log_text = fileread(log_file7);
% 
 [starts_loss13, tokens_loss13] = regexp(log_text, pattern, 'start', 'tokens');
 [starts_loss14, tokens_loss14] = regexp(log_text, pattern2, 'start', 'tokens');
% 
 for nt = nt+1:nt+numel(tokens_loss13)
    loss2(1,nt) = str2double(tokens_loss14{nt-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss13{nt-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
 end
 
 
 log_text = fileread(log_file8);
% 
 [starts_loss15, tokens_loss15] = regexp(log_text, pattern, 'start', 'tokens');
 [starts_loss16, tokens_loss16] = regexp(log_text, pattern2, 'start', 'tokens');
% 
 for nt = nt+1:nt+numel(tokens_loss15)
    loss2(1,nt) = str2double(tokens_loss16{nt-numel(tokens_loss13)-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss15{nt-numel(tokens_loss13)-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
 end
 
 log_text = fileread(log_file9);
% 
 [starts_loss17, tokens_loss17] = regexp(log_text, pattern, 'start', 'tokens');
 [starts_loss18, tokens_loss18] = regexp(log_text, pattern2, 'start', 'tokens');
% 
 for nt = nt+1:nt+numel(tokens_loss17)
    loss2(1,nt) = str2double(tokens_loss18{nt-numel(tokens_loss15)-numel(tokens_loss13)-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss17{nt-numel(tokens_loss15)-numel(tokens_loss13)-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
 end
 
 log_text = fileread(log_file10);
% 
 [starts_loss19, tokens_loss19] = regexp(log_text, pattern, 'start', 'tokens');
 [starts_loss20, tokens_loss20] = regexp(log_text, pattern2, 'start', 'tokens');
% 
 for nt = nt+1:nt+numel(tokens_loss19)
    loss2(1,nt) = str2double(tokens_loss20{nt-numel(tokens_loss17)-numel(tokens_loss15)-numel(tokens_loss13)-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{2});
    iters(nt) = str2double(tokens_loss19{nt-numel(tokens_loss17)-numel(tokens_loss15)-numel(tokens_loss13)-numel(tokens_loss11)-numel(tokens_loss9)-numel(tokens_loss7)-numel(tokens_loss5)-numel(tokens_loss3)-numel(tokens_loss)}{1}); 
 end
 

a = [5000:5000:250000];
b = [0.12169441733333333, 0.12018796799999999, 0.11204298533333332, 0.10940608133333335, 0.10439727466666665, 0.1047321764, 0.10558891466666667, 0.10390143333333333, 0.099457852933333341, 0.10055036959999998, 0.10083381813333334, 0.10120946439999999, 0.099844928933333327, 0.09827354733333335, 0.099585485466666679, 0.09942529239999999, 0.1014671804, 0.096441108133333328, 0.10036693279999999, 0.097456616933333337, 0.095977439600000006, 0.095092371466666686, 0.096712447466666657, 0.096504998666666675, 0.093381430266666676, 0.094327313866666665, 0.09565100746666666, 0.092775999600000006, 0.093895871466666669, 0.091928919199999987, 0.094127537333333344, 0.096212417066666667, 0.095494435599999997, 0.09625717146666668, 0.094080970533333336, 0.095070184133333346, 0.095469840933333328, 0.093005521466666671, 0.095080052133333343, 0.093886152266666675, 0.093304072133333346, 0.09254822493333334, 0.094087924800000014, 0.093697354666666663, 0.093085843200000004, 0.093589558799999986, 0.092023007200000007, 0.089880756666666659, 0.0924251876, 0.094552735066666671];
%a2 = [5000:5000:255000];
%c = [0.12238933866666671, 0.11932103600000001, 0.11948982746666668, 0.10760295853333332, 0.11173175906666666, 0.1189914365333333, 0.11177588319999998, 0.11341491413333335, 0.10853396586666667, 0.10900902946666667, 0.110681666, 0.10955979173333336, 0.10975600333333335, 0.10734115840000001, 0.10628489786666667, 0.10911235106666664, 0.10706272866666668, 0.11293571359999999, 0.1067401444, 0.10871797106666667, 0.11330240719999997, 0.10420204493333333, 0.10895570160000001, 0.11043679720000001, 0.1100592104, 0.10877248026666668, 0.10943323613333333, 0.11204356053333332, 0.11344373466666664, 0.11602386533333332, 0.11225758799999999, 0.11285580453333331, 0.11317931413333333, 0.11538462839999998, 0.11834421093333333, 0.11809124493333334, 0.11318885426666671, 0.11615750613333332, 0.11462728080000002, 0.11457401266666664, 0.11650352026666667, 0.12248726119999999, 0.11709022853333335, 0.12143815293333332, 0.11242636826666666, 0.11338571706666668, 0.11444545213333332, 0.11053837613333335, 0.11930311693333333, 0.11586521613333337, 0.11221613746666663];

%a3 = [5000:5000:210000];
%d = [0.15368461866666663, 0.1410961093333333, 0.139660592, 0.13735466400000002, 0.12968380266666668, 0.13012432666666668, 0.12899470759999998, 0.12615157773333335, 0.12157382773333336, 0.12083409946666665, 0.11997682173333331, 0.11172546799999999, 0.11580976146666665, 0.11957473773333334, 0.12467204253333336, 0.11468584333333333, 0.11615805546666669, 0.11941216680000001, 0.12268074480000001, 0.12187958186666667, 0.1221342624, 0.11337972360000002, 0.1203893052, 0.10851281733333334, 0.11618967706666669, 0.11934714533333332, 0.11645375866666666, 0.13537429986666666, 0.11623894239999996, 0.12248424773333333, 0.12632321413333333, 0.13272043253333332, 0.13006719693333332, 0.12764817760000002, 0.12377575266666668, 0.12791136359999999, 0.12420839146666668, 0.13405986746666665, 0.12409603213333334, 0.13388353506666667, 0.12995799906666672, 0.1353177498666667, 0.12816901173333334, 0.12841654853333337, 0.12968476053333333, 0.13070913226666664, 0.130401302, 0.13551395586666667, 0.13451765373333333, 0.1364895541333333, 0.13603186453333332, 0.12788500853333334, 0.13086522186666669, 0.13964870679999997, 0.13556205640000002, 0.13654797706666669, 0.1328278916, 0.12658023199999999, 0.13018144426666667, 0.13761480399999998];
%a4 = [5000:5000:490000];
%e = [0.21937587866666661, 0.21453027733333338, 0.22964856400000003, 0.19044780799999997, 0.19651129733333333, 0.19712081066666667, 0.19299763733333331, 0.19556698666666666, 0.19083324666666665, 0.18847683066666671, 0.18965412266666662, 0.18327721466666666, 0.19656357999999999, 0.19615218400000003, 0.19454076533333337, 0.18382742399999999, 0.19459222533333334, 0.19786032933333333, 0.17982750133333333, 0.19249676000000002, 0.18818893866666667, 0.18594449866666665, 0.19516007466666666, 0.19009740533333333, 0.19365263599999999, 0.19939177199999999, 0.197563876, 0.19168381599999998, 0.18877064133333332, 0.19676700399999997, 0.18923465733333336, 0.18949814133333331, 0.19429411999999999, 0.19523506933333332, 0.19154917599999999, 0.19093224, 0.19348891200000001, 0.19299872666666665, 0.1952219586666667, 0.19273258266666668, 0.20082714133333332, 0.19635259066666669, 0.19120158266666668, 0.19041488266666667, 0.20003021333333332, 0.19724881866666669, 0.19658732133333334, 0.19350074933333331, 0.19580395866666667, 0.19290663600000002, 0.19892503066666667, 0.19171376266666668, 0.1954067786666667, 0.19648889733333333, 0.19500270799999997, 0.19623020666666666, 0.19717517866666665, 0.19960694800000001, 0.19882461333333334, 0.19397224000000002];

%g = [1.0952096399999998, 0.84413189333333327, 0.82327657333333326, 0.84906608800000005, 0.85029874666666683, 0.89599622533333312, 0.92721080000000011, 0.98328084000000004, 0.92465134400000015, 0.95422580000000001, 0.95731881333333335, 1.0000865466666666, 0.95192130666666663, 0.98139961333333325, 0.86341042666666656, 0.81228319466666654, 0.98485145333333357, 0.99417294666666678, 1.0065465866666667, 0.99132311733333345, 0.97501533066666657, 0.96224497333333336, 0.90936270133333319, 0.96329804000000008, 0.98958569333333346, 1.0129854666666669, 1.0273865466666665, 0.95821498533333338, 0.94926385333333319, 0.91212768666666666, 0.9505008266666668, 0.96450714933333337, 1.0187820133333332, 0.97933335999999993, 1.0215310666666664, 0.96739958666666681, 0.99063756666666658, 1.0069709733333334, 0.95378412000000001, 0.92132837333333328, 0.93907574533333327, 0.96920909333333349, 1.0096083866666667, 0.9779987333333332, 0.94228288000000004, 1.0215774933333333, 1.00053872, 0.95494622666666662, 0.97901130666666669, 0.98848932000000012, 1.0302847733333331, 0.95565361333333343, 0.97426900000000005, 0.95134946133333342, 0.96455321333333355, 1.0092487120000002, 1.03200384, 0.96945435866666685, 0.95862272933333348, 1.0474883733333336];
%h = [0.12169441733333333, 0.12018796799999999, 0.11204298533333332, 0.10940608133333335, 0.10439727466666665, 0.1047321764, 0.10558891466666667, 0.10390143333333333, 0.099457852933333341, 0.10055036959999998, 0.10083381813333334, 0.10120946439999999, 0.099844928933333327, 0.09827354733333335, 0.099585485466666679, 0.09942529239999999, 0.1014671804, 0.096441108133333328, 0.10036693279999999, 0.097456616933333337, 0.095977439600000006, 0.095092371466666686, 0.096712447466666657, 0.096504998666666675, 0.093381430266666676, 0.094327313866666665, 0.09565100746666666, 0.092775999600000006, 0.093895871466666669, 0.091928919199999987, 0.094127537333333344, 0.096212417066666667, 0.095494435599999997, 0.09625717146666668, 0.094080970533333336, 0.095070184133333346, 0.095469840933333328, 0.093005521466666671, 0.095080052133333343, 0.093886152266666675, 0.093304072133333346, 0.09254822493333334, 0.094087924800000014, 0.093697354666666663, 0.093085843200000004, 0.093589558799999986, 0.092023007200000007, 0.089880756666666659, 0.0924251876, 0.094552735066666671, 0.093704346933333349, 0.092168886266666666, 0.091933650533333341, 0.091494738400000011, 0.093121551466666674, 0.095712418800000018, 0.0911042096, 0.093371613466666656, 0.095379731333333329, 0.091409669866666668];
%i = [0.11005210266666668, 0.11200741253333334, 0.09585623453333332, 0.097728079333333343, 0.094493760400000015, 0.091224023066666673, 0.091182772933333336, 0.089596833733333325, 0.08877396039999999, 0.088535239199999977, 0.088912972133333337, 0.086879036666666673, 0.08892961399999999, 0.086770328133333338, 0.083948307333333333, 0.08949133586666666, 0.08186875213333332, 0.091701907333333346, 0.08327585106666667, 0.084641722666666669, 0.07583902613333332, 0.088304327333333349, 0.08026883306666667, 0.073167633600000004, 0.075206576266666658, 0.076171618933333324, 0.079095966399999995, 0.094407967199999998, 0.07881952573333334, 0.08007330746666666, 0.077594162399999986, 0.071232764266666679, 0.07711166559999999, 0.072612824133333337, 0.074017716533333319, 0.075162199066666671, 0.070844771599999995, 0.077155504799999997, 0.084341930533333331, 0.080721835866666675, 0.08423153266666665, 0.081155019866666664, 0.077454873466666671, 0.083249839733333345, 0.084142716800000017, 0.076283355999999997, 0.079081371600000006, 0.074525610533333342, 0.077773724400000008, 0.078723798266666659, 0.083946618133333331, 0.07265117733333333, 0.073906698933333334, 0.073994662133333319, 0.075053201066666672, 0.069979852000000023, 0.07225663626666666, 0.083231421999999999, 0.083531147333333333, 0.076137315733333336];
%a5 = [5000:5000:300000];
%f = [0.12766396266666666, 0.10829395733333333, 0.10772391999999999, 0.093039525333333331, 0.10898473466666665, 0.10461920800000002, 0.11124709599999998, 0.10813412133333335, 0.10826925066666668, 0.090802429333333337, 0.089217840000000007, 0.10308744400000001, 0.093979038666666653, 0.088820748000000005, 0.090616199999999994, 0.085478853333333327, 0.080013846666666666, 0.12132198266666668, 0.081087093333333332, 0.087043930666666672, 0.090322787999999987, 0.080552930666666675, 0.092773120000000014, 0.077688505333333338, 0.082284805333333322, 0.074823401333333331, 0.091505273333333345, 0.073712353333333341, 0.078421299999999985, 0.079852854666666667, 0.074020558666666653, 0.078430322666666663, 0.086045475999999996, 0.079059577333333339, 0.069802964000000009, 0.085436270666666661, 0.088065322666666668, 0.074560982666666664, 0.069033571999999988, 0.065966638666666674, 0.077018942666666673, 0.071568113333333322, 0.067670503999999992, 0.073778868000000011, 0.075626596000000004, 0.075081571999999999, 0.081072210666666658, 0.071953372000000015, 0.063530630666666671, 0.075061802666666663, 0.076963901333333348, 0.068690128000000003, 0.072622464000000012, 0.067389185333333324, 0.074588589333333316, 0.085274062666666664, 0.080698036000000001, 0.065622949333333333, 0.063093586666666659, 0.063346086666666676];

hold on;

%plot(a2, c, '-r');
%plot(a1, d, '-g');
%plot(a1, e, '-b');
%plot(a1, g, '-b');
%plot(a1, h, '-b');
%plot(a1, i, '-b');
%plot(a5, f, '-c');
%hold off;


%%b = b * 10000;
H = gausswin(500);
H = H / sum(H);
avg_loss = conv(loss2, H, 'same');
%figure, plot(iters, loss2(1,1:size(iters,2)), '-b');
%%hold on;
plot(iters, avg_loss(1,1:size(iters,2)), '-r');
%%plot(a1, b, '-g');
%%plot(a, b, '-g');
%%legend('train','test');
%%ylabel('train/test loss');
ylabel('train loss');
%ylabel('test loss');
xlabel('iterations'); 